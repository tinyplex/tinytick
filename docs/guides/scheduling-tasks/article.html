<nav><ul><li><a href="/">TinyTick</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/scheduling-tasks/">Scheduling Tasks</a></li></ul></nav><section class="s1" id="/guides/scheduling-tasks/" data-id="ST"><h1>Scheduling Tasks</h1><p>This guide shows you how to schedule tasks to run in TinyTick.</p><p>In the <a href="/guides/defining-tasks/">Defining Tasks</a> guide, you learned how to define tasks and set their configuration. Now you will see how to schedule these tasks to run at specific times.</p><h3 id="a-quick-word-about-timestamps-durations">A quick word about timestamps &amp; durations</h3><p>TinyTick uses numbers to indicate when to schedule tasks, and they always represent a number of milliseconds. <em>BUT</em> there&#x27;s an important thing to understand about these values when passed in to schedule a task run:</p><ul><li>If the number used is greater than the number of milliseconds in a single year (31536000000), TinyTick will interpret it as meaning &#x27;milliseconds since the start of 1970&#x27;. These are absolute timestamps (represented by the <a href="/api/tinytick/type-aliases/timing/timestampms/"><code>TimestampMs</code></a> type).</li><li>If the number used is less than or equal to the number of milliseconds in a single year, TinyTick will interpret it as meaning &#x27;milliseconds from now&#x27;. These are relative durations (represented by the <a href="/api/tinytick/type-aliases/timing/durationms/"><code>DurationMs</code></a> type).</li></ul><p>This allows you to easily schedule tasks to run at specific times in the future, <em>or</em> some reasonable interval from the present. It is not expected that TinyTick will be used to schedule things for more than a year in the future though you can just create an absolute timestamp to do so if you need.</p><h3 id="scheduling-a-task-run"><a href="/demos/scheduling/">Scheduling</a> a task run</h3><p>To schedule a task to run, you simply use the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/"><code>scheduleTaskRun</code></a> method of the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a>. It has one mandatory parameter, which is the task <a href="/api/tinytick/type-aliases/identity/id/"><code>Id</code></a> of the task you want to run. Here we create a <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a>, start it, register a task called <code>ping</code>, and schedule it:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createManager<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinytick'</span><span class="punctuation">;</span>

<span class="keyword">const</span> manager <span class="operator">=</span> <span class="function"><a href="/api/tinytick/functions/creation/createmanager/">createManager</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/lifecycle/start/">start</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>

manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/task/settask/">setTask</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="keyword">async</span> <span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="keyword">await</span> <span class="function">fetch</span><span class="punctuation">(</span><span class="string">'https://example.org'</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ... wait 100ms (the Manager tickInterval) for task run to start</span>
</code></pre><p>That&#x27;s it! Since we didn&#x27;t provide a timestamp, TinyTick will run the task as soon as the next tick comes around (by default within 100ms).</p><h3 id="scheduling-a-task-with-a-parameter"><a href="/demos/scheduling/">Scheduling</a> a task with a parameter</h3><p>As we saw in the <a href="/guides/defining-tasks/">Defining Tasks</a> guide, you can configure a task to accept a single string parameter when it is run. This is useful when you want to run the same task with different inputs. This is provided as the second argument the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/"><code>scheduleTaskRun</code></a> method:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/task/settask/">setTask</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">url</span><span class="punctuation">)</span> <span class="operator">=></span> <span class="keyword">await</span> <span class="function">fetch</span><span class="punctuation">(</span>url<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>

manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://tinytick.org'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This means you can schedule multiple similar tasks where only the single parameter varies.</p><h3 id="scheduling-a-task-to-run-at-a-specific-time"><a href="/demos/scheduling/">Scheduling</a> a task to run at a specific time</h3><p>If you want to schedule a task to run at a specific time, you can provide a timestamp as the third argument to the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/"><code>scheduleTaskRun</code></a> method. As we saw above, this can be an absolute timestamp (if greater than 31536000000) or a relative duration (otherwise), both in milliseconds:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://tinybase.org'</span><span class="punctuation">,</span> <span class="number">1000</span><span class="punctuation">)</span><span class="punctuation">;</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://tinytick.org'</span><span class="punctuation">,</span> <span class="number">2000</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> birthday <span class="operator">=</span> Date<span class="punctuation">.</span><span class="function">parse</span><span class="punctuation">(</span><span class="string">'2024-04-28 00:00:00'</span><span class="punctuation">)</span><span class="punctuation">;</span> <span class="comment">// 1745827200000</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://tripleodeon.com'</span><span class="punctuation">,</span> birthday<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>This schedules three task runs, one in approximately 1 second&#x27;s time, one another second after that, and one on a birthday in 2024.</p><p>Note that if you schedule a task run with a timestamp in the past, TinyTick will run it immediately. So if you are reading this guide after April 2024, the birthday task run will run before the first two!</p><h3 id="configuring-timeouts-and-retries">Configuring timeouts and retries</h3><p>As we saw in the <a href="/guides/defining-tasks/">Defining Tasks</a> guide, you can configure a task to set things like a maximum duration and number of retries (or assign it to a category that does). These can be further overridden when scheduling an individual task run, using the fourth parameter:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://fast.org'</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">;</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://slow.org'</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">maxDuration</span><span class="operator">:</span> <span class="number">5000</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Of course it&#x27;s worth pointing out that these tasks are all now sitting in the queue to execute as soon as the next &#x27;tick&#x27; comes around (every 100ms by default). To make sure the tasks scheduled above all run, we just need to wait a little bit and/or stop the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a>.</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/lifecycle/stop/">stop</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ... wait 2100ms (to be sure the previous scheduled tasks have completed)</span>
</code></pre><h3 id="accessing-the-manager-s-task-runs">Accessing the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a>&#x27;s task runs</h3><p>The <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/"><code>scheduleTaskRun</code></a> method returns a newly-created and unique string <a href="/api/tinytick/type-aliases/identity/id/"><code>Id</code></a> for the task run. You&#x27;ll be able to use this to find out its status and information about it.</p><pre><code><span class="keyword">const</span> taskRunId <span class="operator">=</span> manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://example.org'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a> exposes a list of task runs that are currently scheduled or that are running. You can access these lists with the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/"><code>getScheduledTaskRunIds</code></a> method and the getRunningTaskRuns method respectively:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/">getScheduledTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 1</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getrunningtaskrunids/">getRunningTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
</code></pre><p>Let&#x27;s wait for the task run to start. It will move from the scheduled list the the running list:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/lifecycle/start/">start</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// ... wait 100ms (the Manager tickInterval) for task run to start</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/">getScheduledTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getrunningtaskrunids/">getRunningTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 1</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getrunningtaskrunids/">getRunningTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">==</span> taskRunId<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> true</span>
</code></pre><p>And then wait for the task run to finish, after which it will disappear from both lists:</p><pre><code><span class="comment">// ... wait 100ms (another tick) for task run to finish</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/">getScheduledTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getrunningtaskrunids/">getRunningTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
</code></pre><p>Once the task run is completed, the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a> forgets about it completely.</p><h3 id="accessing-task-run-properties">Accessing task run properties</h3><p>There are two ways to access information about a single task run once it is scheduled or running. One returns the task run&#x27;s timeout and retry configuration, and the other its status.</p><p>Firstly the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/gettaskrunconfig/"><code>getTaskRunConfig</code></a> method returns the configuration for a task run:</p><pre><code><span class="keyword">const</span> taskRunId2 <span class="operator">=</span> manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'ping'</span><span class="punctuation">,</span> <span class="string">'https://example.org'</span><span class="punctuation">)</span><span class="punctuation">;</span>

console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/gettaskrunconfig/">getTaskRunConfig</a></span><span class="punctuation">(</span>taskRunId2<span class="punctuation">,</span> <span class="boolean">true</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> {maxDuration: 1000, maxRetries: 0, retryDelay: 1000, repeatDelay: null}</span>
</code></pre><p>The <code>true</code> argument to getTaskRunConfig ensures you see the inherited and default values as well as any overrides for the specific task run (of which there are none in this case)</p><p>Secondly, the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/gettaskruninfo/"><code>getTaskRunInfo</code></a> method returns the status of a task run, including its <a href="/api/tinytick/type-aliases/identity/id/"><code>Id</code></a>, any parameter passed to it, whether it&#x27;s running yet or not, any retries it&#x27;s undertaken and so on:</p><pre><code><span class="keyword">const</span> info <span class="operator">=</span> manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/gettaskruninfo/">getTaskRunInfo</a></span><span class="punctuation">(</span>taskRunId2<span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>info<span class="punctuation">.</span>taskId<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'ping'</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>info<span class="punctuation">.</span>arg<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 'https://example.org'</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>info<span class="punctuation">.</span>running<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> false</span>
</code></pre><p>This returned object is of the <a href="/api/tinytick/type-aliases/taskrun/taskruninfo/"><code>TaskRunInfo</code></a> type. It is useful for checking the status of a task run, and for debugging.</p><h3 id="deleting-or-cancelling-a-task-run">Deleting or cancelling a task run</h3><p>Before it starts running, you can remove a task run from being run in the future with the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/deltaskrun/"><code>delTaskRun</code></a> method:</p><pre><code>console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/">getScheduledTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 1</span>

manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/deltaskrun/">delTaskRun</a></span><span class="punctuation">(</span>taskRunId2<span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/getscheduledtaskrunids/">getScheduledTaskRunIds</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">.</span>length<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="comment">// -> 0</span>
</code></pre><p>If the task is already running, using the <a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/deltaskrun/"><code>delTaskRun</code></a> method will cause an attempt to abort it.</p><h3 id="summary">Summary</h3><p>You now know 90% of what TinyTick is all about. It&#x27;s time just to run through a few final features and extra tricks, for which we should proceed to the <a href="/guides/advanced-usage/">Advanced Usage</a> guides.</p></section>