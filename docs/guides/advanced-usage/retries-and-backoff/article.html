<nav><ul><li><a href="/">TinyTick</a></li><li><a href="/guides/">Guides</a></li><li><a href="/guides/advanced-usage/">Advanced Usage</a></li><li><a href="/guides/advanced-usage/retries-and-backoff/">Retries And Backoff</a></li></ul></nav><section class="s1" id="/guides/advanced-usage/retries-and-backoff/" data-id="RAB"><h1>Retries And Backoff</h1><p>Since a task run can be aborted (if it times out) or throw an error, it&#x27;s useful for the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a> to be able to retry it - and you can completely control how many times a task run is retried until it is successful, and how long to wait between each retry.</p><h3 id="configuring-retries">Configuring retries</h3><p>The relevant configuration properties are <code>maxRetries</code> and <code>retryDelay</code>. These will have been provided when the task run was scheduled, or will have been inherited from the task or the task&#x27;s category. The default <code>maxRetries</code> value is zero, so you will have to explicitly increase that to get retry behavior.</p><p>To demonstrate things, first let&#x27;s set up a <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a>:</p><pre><code><span class="keyword">import</span> <span class="punctuation">{</span>createManager<span class="punctuation">}</span> <span class="keyword">from</span> <span class="string">'tinytick'</span><span class="punctuation">;</span>

<span class="keyword">const</span> manager <span class="operator">=</span> <span class="function"><a href="/api/tinytick/functions/creation/createmanager/">createManager</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/lifecycle/start/">start</a></span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>The following then defines a task called &#x27;tryMe&#x27; that will throw an error the first two times it is run. We also configure it to retry three times by default, with 200ms between each retry:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/task/settask/">setTask</a></span><span class="punctuation">(</span>
  <span class="string">'tryMe'</span><span class="punctuation">,</span>
  <span class="keyword">async</span> <span class="punctuation">(</span><span class="parameter">arg<span class="punctuation">,</span> signal<span class="punctuation">,</span> <span class="punctuation">{</span>retry<span class="punctuation">}</span></span><span class="punctuation">)</span> <span class="operator">=></span> <span class="punctuation">{</span>
    <span class="keyword">if</span> <span class="punctuation">(</span>retry <span class="operator">&lt;</span> <span class="number">2</span><span class="punctuation">)</span> <span class="punctuation">{</span>
      console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="template-string"><span class="template-punctuation">`</span><span class="string">Attempt </span><span class="interpolation"><span class="interpolation-punctuation">${</span>retry <span class="operator">+</span> <span class="number">1</span><span class="interpolation-punctuation">}</span></span><span class="string">. Try again!</span><span class="template-punctuation">`</span></span><span class="punctuation">)</span><span class="punctuation">;</span>
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="class-name">Error</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
    <span class="punctuation">}</span>
    console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="string">'Success!'</span><span class="punctuation">)</span><span class="punctuation">;</span>
  <span class="punctuation">}</span><span class="punctuation">,</span>
  <span class="string">''</span><span class="punctuation">,</span>
  <span class="punctuation">{</span><span class="literal-property">maxRetries</span><span class="operator">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="literal-property">retryDelay</span><span class="operator">:</span> <span class="number">200</span><span class="punctuation">}</span><span class="punctuation">,</span>
<span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Notice how we are using the <a href="/api/tinytick/type-aliases/taskrun/taskruninfo/"><code>TaskRunInfo</code></a> object that gets passed into the task function to keep track of which retry this is.</p><p>Let&#x27;s schedule it:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'tryMe'</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>After waiting 100ms (the <a href="/api/tinytick/interfaces/manager/manager/"><code>Manager</code></a> tick interval), the task run will start, and immediately error:</p><pre><code><span class="comment">// ... wait 100ms for task run to start</span>
<span class="comment">// -> 'Attempt 1. Try again!'</span>
</code></pre><p>We can expect the task run to be retried after 200ms:</p><pre><code><span class="comment">// ... wait 200ms to be sure task run is retried once</span>
<span class="comment">// -> 'Attempt 2. Try again!'</span>
</code></pre><p>And the third time, we expect it to succeed!</p><pre><code><span class="comment">// ... wait 200ms to be sure task run is retried once more</span>
<span class="comment">// -> 'Success!'</span>
</code></pre><h3 id="backing-off">Backing off</h3><p>In the example above, we simply retry the task 3 times with a fixed delay of 200ms between each attempt. In the real world you may want to &#x27;back off&#x27; the retries so that you do not, for example, flood a resource that is not available with repetitive requests.</p><p>To do this, you can provide a <code>retryDelay</code> configuration property as not a number (in milliseconds), but a string of comma-delimited intervals. These will be used in sequence for each retry attempt. For example, to retry the task from above with delays of 100ms, 200ms, and 400ms (an exponential backoff, of sorts), you would set the string to &#x27;100,200,400&#x27;.</p><p>Let&#x27;s schedule our task again, but this time with a backoff sequence that retries once quickly, and then once more slowly:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'tryMe'</span><span class="punctuation">,</span> <span class="string">''</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">{</span><span class="literal-property">retryDelay</span><span class="operator">:</span> <span class="string">'100,400'</span><span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>(In reality, a <code>retryDelay</code> property like this would probably be defined for the task as a whole. Here we are just setting it for one run for clarity.)</p><p>But now let&#x27;s wait for the task to run and retry again.</p><pre><code><span class="comment">// ... wait 100ms for task run to start</span>
<span class="comment">// -> 'Attempt 1. Try again!'</span>
<span class="comment">// ... wait 200ms to be sure task run is retried once</span>
<span class="comment">// -> 'Attempt 2. Try again!'</span>
<span class="comment">// ... wait 200ms - but this is not long enough for the second retry</span>
<span class="comment">// -> /* nothing logged */</span>
<span class="comment">// ... wait 200ms once more - now long enough for the second retry</span>
<span class="comment">// -> 'Success!'</span>
</code></pre><p>Note that if you configure a task to run with more possible retries than there are entries in the <code>retryDelay</code> string, the last entry will be used for the remainder of the retries. In other words, this:</p><pre><code>manager<span class="punctuation">.</span><span class="function"><a href="/api/tinytick/interfaces/manager/manager/methods/taskrun/scheduletaskrun/">scheduleTaskRun</a></span><span class="punctuation">(</span><span class="string">'tryMe'</span><span class="punctuation">,</span> <span class="string">''</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">{</span>
  <span class="literal-property">maxRetries</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span>
  <span class="literal-property">retryDelay</span><span class="operator">:</span> <span class="string">'100,200,400'</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre><p>Would result in intervals of 100ms, 200ms, 400ms, then 400ms between attempts.</p><h3 id="summary">Summary</h3><p>TinyTick provides some simple but powerful tools for retrying tasks that fail, by allowing you to configure the number of retries and the delay between each retry. You can also use a backoff strategy to prevent overwhelming a resource with repeated requests.</p><p>And now, let&#x27;s conclude with the <a href="/guides/advanced-usage/starting-and-stopping/">Starting And Stopping</a> guide!</p></section>